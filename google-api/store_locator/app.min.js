function initAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("address"),{types:["geocode"]})}function getDataList(e){$.each(e,function(e,t){var a='<a href="#" class="list-group-item panel-item panel-item-'+t.id+'" store-id="'+t.id+'"></a>';jQuery("#map-panel .list-group").append(a);var s={id:t.id};if(""==t.address||"undefined"==typeof t.address)jQuery.ajax({url:"getDesc.php",data:s,dataType:"json",success:function(s){t.address=s.data.address,t.store_name=s.data.store_name;var o=e+1;t.setIcon("icons/open_"+o+".png"),t.operating_hours=s.data.operation_hours,a='<h4 class="list-group-item-heading">'+o+")"+t.store_name+'</h4><p class="list-group-item-text"><table><tr><td style="width:175px;">'+t.address+"<br>"+t.distance+' mi<br><button type="button"  data-dismiss="modal" class="select-store" data-value="'+t.id+'">Ship to this address</button></td><td style="padding: 0px;vertical-align: top;">'+t.operating_hours+"</td></tr></table></p>",jQuery(".panel-item-"+t.id).html(a)}});else{var o=e+1;t.setIcon("icons/open_"+o+".png"),a='<h4 class="list-group-item-heading">'+o+")"+t.store_name+'</h4><p class="list-group-item-text"><table><tr><td style="width:175px;">'+t.address+"<br>"+t.distance+' mi<br><button type="button"  data-dismiss="modal" class="select-store" data-value="'+t.id+'">Ship to this address</button></td><td style="padding: 0px;vertical-align: top;">'+t.operating_hours+"</td></tr></table></p>",jQuery(".panel-item-"+t.id).html(a)}}),AutoCenter(),jQuery("#pagination").show()}function initializeMap(){map_id=document.getElementById("map-canvas");var e={zoom:1,center:{lat:24.260547,lng:11.714687},mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),e),google.maps.event.addListener(map,"dragend",function(e){console.log("Drag End")}),google.maps.event.addListener(map,"dragstart",function(e){jQuery(".loading-content img").css("opacity","1")}),geocoder=new google.maps.Geocoder;var t=document.getElementById("address").value;""==t&&(t=getParameterByName("address")),""!=t&&geocoder.geocode({address:t},function(e,t){if(t===google.maps.GeocoderStatus.OK){var a=e[0].geometry.location;map.setCenter(a),map.setZoom(13),pageno=1,page=0,jQuery(".previous").addClass("disabled"),jQuery("#page-number").html(pageno),jQuery(".previous").attr("disabled","disabled"),searchStoresBounds(map.getBounds().toUrlValue())}else alert("Geocode was failed: "+t)})}function searchAddress(e){geocoder.geocode({address:e},function(t,a){if(a===google.maps.GeocoderStatus.OK){var s=t[0].geometry.location;map.setCenter(s),map.setZoom(13),console.log(e),console.log(map.getBounds().toUrlValue()),searchStoresBounds(map.getBounds().toUrlValue())}else alert("Geocode was failed: "+a)})}function searchStoresBounds(){if(map.getBounds()){var e=map.getBounds().toUrlValue(),t="./locations-api2.php",a={bounds:e};$.each(markers,function(e,t){t.setMap(null)}),selMarker=[],jQuery.ajax({url:t,data:a,dataType:"json",success:showStores})}}function showStores(e,t,a){if("OK"==e.status){var s=e.data.length,o=s/inter;for(o==parseInt(o)?pages=o:pages=parseInt(o)+1,jQuery(".total-locations").html(pages),jQuery("#map-panel .list-group").html(""),markers=[],markersById=[],i=0;i<e.data.length;i++)marker=new google.maps.Marker({position:new google.maps.LatLng(e.data[i].lat,e.data[i].lng),map:map,icon:"pin-2.png",lat:e.data[i].lat,lng:e.data[i].lng,id:e.data[i].id,distance:e.data[i].distance}),markers[i]=marker,markersById[e.data[i].id]=marker,markerContent[e.data[i].id]=e.data[i].address,google.maps.event.addListener(marker,"click",function(e,t){return function(){$(".infowindow").remove(),$.each(markers,function(e,t){t.setIcon("pin-2.png")}),$.each(selMarker,function(e,t){var a=e+1;t.setIcon("icons/open_"+a+".png")}),jQuery("#location-info").show(),jQuery(".panel-item").css("background-color","transparent"),jQuery(".panel-item-"+e.id).css("background-color","#f5f5f5");var t=jQuery(".panel-item-"+e.id).offset();if("undefined"!=typeof t){var a=jQuery("#map-panel"),s=jQuery(".panel-item-"+e.id);a.animate({scrollTop:s.offset().top-a.offset().top+a.scrollTop()})}e.setIcon("pin-1.png"),$.each(selMarker,function(t,a){if(a.id==e.id){var s=t+1;e.setIcon("icons/close_"+s+".png")}});var o={id:e.id};if("undefined"==typeof e.store_name||"undefined"==typeof e.store_pic)jQuery.ajax({url:"getDesc.php",data:o,dataType:"json",success:function(t){e.store_name=t.data.store_name,e.store_pic=t.data.store_pic,e.address=t.data.address,e.store_name=t.data.store_name,e.operating_hours=t.data.operation_hours,jQuery(".selected-store .store-name").html('<input type="hidden" id="location-id" value="'+e.id+'" data-value="'+e.id+'">'+e.store_name),jQuery(".selected-store .store-address").html(e.address),jQuery(".selected-store .store-image").html('<img class="img-thumbnail" src="'+e.store_pic+'">'),jQuery(".selected-store .store-description").html('<button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button><br><strong>Operating Hours</strong><br>'+e.operating_hours);var a=e.address+'<br><button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button>',s=0,o=0,r=0;$.each(selMarker,function(t,a){a.id==e.id&&(s=1)}),1==s?(o=31,r=24):(o=9,r=9);new SmartInfoWindow({position:e.getPosition(),map:map,content:a,height:o,width:r})}});else{jQuery(".selected-store .store-name").html('<input type="hidden" id="location-id" value="'+e.id+'" data-value="'+e.id+'">'+e.store_name),jQuery(".selected-store .store-address").html(e.address),jQuery(".selected-store .store-image").html('<img class="img-thumbnail" src="'+e.store_pic+'">'),jQuery(".selected-store .store-description").html('<button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button><br><strong>Operating Hours</strong><br>'+e.operating_hours);var r=e.address+'<br><button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button>',n=0,i=0,d=0;$.each(selMarker,function(t,a){a.id==e.id&&(n=1)}),1==n?(i=31,d=24):(i=9,d=9);{new SmartInfoWindow({position:e.getPosition(),map:map,content:r,height:i,width:d})}}}}(marker,i)),google.maps.event.addListener(marker,"mouseover",function(e,t){return function(){$(".infowindow").remove(),$.each(markers,function(e,t){t.setIcon("pin-2.png")}),$.each(selMarker,function(e,t){var a=e+1;t.setIcon("icons/open_"+a+".png")}),jQuery("#location-info").show(),e.setIcon("pin-1.png"),$.each(selMarker,function(t,a){if(a.id==e.id){var s=t+1;e.setIcon("icons/close_"+s+".png")}});var t={id:e.id};if("undefined"==typeof e.store_name||"undefined"==typeof e.store_pic)jQuery.ajax({url:"getDesc.php",data:t,dataType:"json",success:function(t){e.store_name=t.data.store_name,e.store_pic=t.data.store_pic,e.address=t.data.address,e.store_name=t.data.store_name,e.operating_hours=t.data.operation_hours,jQuery(".selected-store .store-name").html('<input type="hidden" id="location-id" value="'+e.id+'" data-value="'+e.id+'">'+e.store_name),jQuery(".selected-store .store-address").html(e.address),jQuery(".selected-store .store-image").html('<img class="img-thumbnail" src="'+e.store_pic+'">'),jQuery(".selected-store .store-description").html('<button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button><br><strong>Operating Hours</strong><br>'+e.operating_hours);var a=e.address+'<br><button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button>',s=0,o=0,r=0;$.each(selMarker,function(t,a){a.id==e.id&&(s=1)}),1==s?(o=31,r=24):(o=9,r=9);new SmartInfoWindow({position:e.getPosition(),map:map,content:a,height:o,width:r})}});else{jQuery(".selected-store .store-name").html('<input type="hidden" id="location-id" value="'+e.id+'" data-value="'+e.id+'">'+e.store_name),jQuery(".selected-store .store-address").html(e.address),jQuery(".selected-store .store-image").html('<img class="img-thumbnail" src="'+e.store_pic+'">'),jQuery(".selected-store .store-description").html('<button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button><br><strong>Operating Hours</strong><br>'+e.operating_hours);var a=e.address+'<br><button type="button" data-dismiss="modal"  class="select-store" data-value="'+e.id+'">Ship to this address</button>',s=0,o=0,r=0;$.each(selMarker,function(t,a){a.id==e.id&&(s=1)}),1==s?(o=31,r=24):(o=9,r=9);{new SmartInfoWindow({position:e.getPosition(),map:map,content:a,height:o,width:r})}}}}(marker,i)),google.maps.event.addListener(marker,"mouseout",function(e,t){return function(){$.each(selMarker,function(e,t){})}}(marker,i));var r=page+1;selMarker=markers.slice(page*inter,inter*r),getDataList(selMarker)}}function AutoCenter(){if(selMarker.length>0){var e=new google.maps.LatLngBounds;$.each(selMarker,function(t,a){e.extend(a.position)}),map.fitBounds(e)}}jQuery(document).on("click",".next",function(e){""!=curLocation&&curLocation.setMap(null),page+=1,pageno+=1,pageno>=pages?(page=pages-1,pageno=pages,jQuery(this).addClass("disabled")):pageno>1&&pageno<pages?(jQuery(".previous").removeClass("disabled"),jQuery(this).removeClass("disabled")):jQuery(this).removeAttr("disabled"),jQuery("#page-number").html(pageno);var t=page+1;selMarker=markers.slice(page*inter,inter*t),$.each(markers,function(e,t){t.setIcon("pin-2.png")}),jQuery(".infowindow").remove(),jQuery("#map-panel .list-group").html(""),getDataList(selMarker)}),jQuery(document).on("change","#address",function(e){""!=curLocation&&curLocation.setMap(null),jQuery("#location-info").hide(),jQuery(".selected-store .store-name").html(""),jQuery(".selected-store .store-address").html(""),jQuery(".selected-store .store-image").html(""),jQuery(".selected-store .store-description").html(""),address=jQuery("#address").val(),null===map&&initializeMap(),jQuery("#page-number").html(page+1),searchAddress(address),jQuery("#pagination").show()}),jQuery(document).on("submit","#store-form",function(e){e.preventDefault(),""!=curLocation&&curLocation.setMap(null),jQuery("#location-info").hide(),jQuery(".selected-store .store-name").html(""),jQuery(".selected-store .store-address").html(""),jQuery(".selected-store .store-image").html(""),jQuery(".selected-store .store-description").html(""),address=jQuery("#address").val(),null===map&&initializeMap(),jQuery("#page-number").html(page+1),searchAddress(address),jQuery("#pagination").show()}),jQuery(document).on("click","#current-location",function(e){e.preventDefault(),""!=curLocation&&curLocation.setMap(null),jQuery("#location-info").hide(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};marker=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:map,icon:"images/current.png",lat:t.lat,lng:t.lng}),curLocation=marker,map.setCenter(t),map.setZoom(13),searchStoresBounds(map.getBounds().toUrlValue()),pageno=1,page=0,jQuery(".previous").addClass("disabled"),jQuery("#page-number").html(pageno),jQuery("#pagination").show()},function(){alert("Browser do not support!")})}),jQuery(document).on("click",".select-store",function(e){""!=curLocation&&curLocation.setMap(null);var t=jQuery(this).attr("data-value"),a=jQuery.grep(markers,function(e){return e.id==t});jQuery("#store-id").val(t),jQuery("#store-address").val(a[0].store_name+","+a[0].address),jQuery("#myModal").data("dismiss",!0)}),jQuery(document).on("click","#reload",function(e){jQuery("#location-info").hide(),""!=curLocation&&curLocation.setMap(null),jQuery("#reload img").attr("src","loading.gif"),jQuery("#reload img").css("opacity","1"),jQuery(".selected-store .store-name").html(""),jQuery(".selected-store .store-address").html(""),jQuery(".selected-store .store-image").html(""),jQuery(".selected-store .store-description").html(""),searchStoresBounds(map.getBounds().toUrlValue()),pageno=1,page=0,jQuery(".previous").addClass("disabled"),jQuery("#page-number").html(pageno),jQuery("#reload img").attr("src","loading.png"),jQuery("#reload img").css("opacity","0.6"),jQuery("#pagination").show()}),jQuery(document).on("click",".panel-item",function(e){var t=jQuery(this).attr("store-id"),a=markersById[t];google.maps.event.trigger(a,"click"),jQuery(".panel-item").css("background-color","transparent");var s=".panel-item-"+t;jQuery(s).css("background-color","#f5f5f5")}),jQuery(document).on("click",".previous",function(e){""!=curLocation&&curLocation.setMap(null),page-=1,pageno-=1,pageno<=1?(page=0,pageno=1,jQuery(this).addClass("disabled")):pageno>1&&pageno<pages?(jQuery(".next").removeClass("disabled"),jQuery(this).removeClass("disabled")):jQuery(this).removeClass("disabled"),jQuery("#page-number").html(pageno);var t=page+1;selMarker=markers.slice(page*inter,inter*t),$.each(markers,function(e,t){t.setIcon("pin-2.png")}),jQuery(".infowindow").remove(),jQuery("#map-panel .list-group").html(""),getDataList(selMarker)});